<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>İsegzidrafok</title>
<style>
    body {
        background: black;
        color: navy;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 10px;
    }
    h1 {
        margin-bottom: 15px;
    }
    input, button, select {
        display: block;
        margin: 8px auto;
        padding: 8px;
        border-radius: 5px;
        border: none;
    }
    input, select {
        width: 80%;
        background: #111;
        color: white;
    }
    button {
        background: #222;
        color: navy;
        cursor: pointer;
    }
    button:hover {
        background: #333;
    }
    .hidden { display: none; }
    .chat-box {
        background: #111;
        padding: 10px;
        margin: 10px auto;
        width: 90%;
        height: 300px;
        overflow-y: auto;
        border: 1px solid navy;
        color: white;
        text-align: left;
    }
    .msg {
        margin: 5px 0;
        padding: 5px;
        border-bottom: 1px solid #333;
    }
    .username {
        font-weight: bold;
        color: cyan;
    }
</style>
</head>
<body>

<h1>İsegzidrafok</h1>

<!-- Ana Giriş Menüsü -->
<div id="mainMenu">
    <button onclick="showRegister()">Yeni Hesap Oluştur</button>
    <button onclick="showLogin()">Hesaba Giriş Yap</button>
    <button onclick="adminLogin()">Yönetici Girişi</button>
</div>

<!-- Yeni Hesap -->
<div id="registerSection" class="hidden">
    <h2>Yeni Hesap Oluştur</h2>
    <input type="text" id="regName" placeholder="İsim (Değiştirilemez)">
    <input type="password" id="regPass" placeholder="Şifre">
    <button onclick="registerUser()">Kaydol</button>
    <button onclick="goBack()">Geri</button>
</div>

<!-- Giriş -->
<div id="loginSection" class="hidden">
    <h2>Hesaba Giriş Yap</h2>
    <input type="text" id="loginName" placeholder="İsim">
    <input type="password" id="loginPass" placeholder="Şifre">
    <button onclick="loginUser()">Giriş Yap</button>
    <button onclick="goBack()">Geri</button>
</div>

<!-- Yönetici Paneli -->
<div id="adminSection" class="hidden">
    <h2>Yönetici Paneli</h2>
    <h3>Bekleyen Kayıt Talepleri</h3>
    <div id="pendingUsers"></div>
    <h3>Engelleme Talepleri</h3>
    <div id="blockRequests"></div>
    <button onclick="goBack()">Çıkış</button>
</div>

<!-- Kullanıcı Ana Menü -->
<div id="userMenu" class="hidden">
    <h2>Hoş geldin, <span id="currentUserName"></span></h2>
    <button onclick="openSettings()">Ayarlar</button>
    <button onclick="openPrivateChat()">Birisiyle Sohbet Oluştur</button>
    <button onclick="openGroupChat()">Toplu Grup</button>
    <button onclick="logout()">Çıkış</button>
</div>

<!-- Ayarlar -->
<div id="settingsSection" class="hidden">
    <h2>Ayarlar</h2>
    <input type="password" id="newPass" placeholder="Yeni Şifre">
    <button onclick="changePassword()">Şifreyi Değiştir</button>
    <button onclick="backToMenu()">Geri</button>
</div>

<!-- Özel Sohbet -->
<div id="privateChatSection" class="hidden">
    <h2>Özel Sohbet</h2>
    <input type="text" id="friendName" placeholder="Arkadaşının İsmi">
    <button onclick="startPrivateChat()">Sohbete Başla</button>
    <div id="privateChatBox" class="chat-box"></div>
    <input type="text" id="privateMsg" placeholder="Mesaj yaz...">
    <button onclick="sendPrivateMsg()">Gönder</button>
    <button onclick="backToMenu()">Geri</button>
</div>

<!-- Grup Sohbet -->
<div id="groupChatSection" class="hidden">
    <h2>Toplu Grup</h2>
    <div id="groupChatBox" class="chat-box"></div>
    <input type="text" id="groupMsg" placeholder="Mesaj yaz...">
    <button onclick="sendGroupMsg()">Gönder</button>
    <button onclick="backToMenu()">Geri</button>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "[]");
let pending = JSON.parse(localStorage.getItem("pending") || "[]");
let blocks = JSON.parse(localStorage.getItem("blocks") || "[]");
let groupChat = JSON.parse(localStorage.getItem("groupChat") || "[]");
let currentUser = null;
let privateChats = JSON.parse(localStorage.getItem("privateChats") || "{}");

function saveAll() {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("pending", JSON.stringify(pending));
    localStorage.setItem("blocks", JSON.stringify(blocks));
    localStorage.setItem("groupChat", JSON.stringify(groupChat));
    localStorage.setItem("privateChats", JSON.stringify(privateChats));
}

function showRegister(){ document.getElementById("mainMenu").classList.add("hidden"); document.getElementById("registerSection").classList.remove("hidden"); }
function showLogin(){ document.getElementById("mainMenu").classList.add("hidden"); document.getElementById("loginSection").classList.remove("hidden"); }
function goBack(){
    document.querySelectorAll("div").forEach(d => d.classList.add("hidden"));
    document.getElementById("mainMenu").classList.remove("hidden");
}
function backToMenu(){
    document.querySelectorAll("div").forEach(d => d.classList.add("hidden"));
    document.getElementById("userMenu").classList.remove("hidden");
}

function registerUser(){
    let name = document.getElementById("regName").value.trim();
    let pass = document.getElementById("regPass").value.trim();
    if(!name || !pass){ alert("İsim ve şifre gir!"); return; }
    if(users.find(u=>u.name===name) || pending.find(u=>u.name===name)){ alert("İsim alınmış!"); return; }
    pending.push({name,pass});
    saveAll();
    alert("Kayıt isteği gönderildi. Yönetici onayı bekleniyor.");
    goBack();
}

function loginUser(){
    let name = document.getElementById("loginName").value.trim();
    let pass = document.getElementById("loginPass").value.trim();
    let user = users.find(u=>u.name===name && u.pass===pass);
    if(user){
        currentUser = user;
        document.getElementById("currentUserName").innerText = currentUser.name;
        backToMenu();
    } else {
        alert("Giriş başarısız. Onaylanmamış olabilir.");
    }
}

function adminLogin(){
    let pw = prompt("Yönetici şifresi:");
    if(pw==="Natrium1126621924"){
        document.getElementById("mainMenu").classList.add("hidden");
        document.getElementById("adminSection").classList.remove("hidden");
        renderPending();
    } else { alert("Yanlış şifre!"); }
}

function renderPending(){
    let pDiv=document.getElementById("pendingUsers");
    pDiv.innerHTML="";
    if(pending.length===0){ pDiv.innerHTML="<p>Bekleyen kayıt yok</p>"; return; }
    pending.forEach((p,i)=>{
        pDiv.innerHTML+=`${p.name} <button onclick="approveUser(${i})">Onayla</button> <button onclick="rejectUser(${i})">Reddet</button><br>`;
    });
}

function approveUser(i){ users.push(pending[i]); pending.splice(i,1); saveAll(); renderPending(); }
function rejectUser(i){ pending.splice(i,1); saveAll(); renderPending(); }

function openSettings(){
    document.getElementById("userMenu").classList.add("hidden");
    document.getElementById("settingsSection").classList.remove("hidden");
}
function changePassword(){
    let newPass=document.getElementById("newPass").value.trim();
    if(!newPass){ alert("Yeni şifre gir!"); return; }
    currentUser.pass=newPass;
    users=users.map(u=>u.name===currentUser.name?currentUser:u);
    saveAll();
    alert("Şifre değişti!");
}
function openPrivateChat(){
    document.getElementById("userMenu").classList.add("hidden");
    document.getElementById("privateChatSection").classList.remove("hidden");
}
function startPrivateChat(){
    let fname=document.getElementById("friendName").value.trim();
    if(!fname){ alert("Arkadaş ismi gir!"); return; }
    let key=[currentUser.name,fname].sort().join("_");
    if(!privateChats[key]) privateChats[key]=[];
    renderPrivateChat(key);
}
function renderPrivateChat(key){
    let box=document.getElementById("privateChatBox");
    box.innerHTML="";
    privateChats[key].forEach(m=>{ box.innerHTML+=`<div class="msg"><span class="username">${m.user}:</span> ${m.text}</div>`; });
}
function sendPrivateMsg(){
    let fname=document.getElementById("friendName").value.trim();
    let key=[currentUser.name,fname].sort().join("_");
    let msg=document.getElementById("privateMsg").value.trim();
    if(!msg)return;
    privateChats[key].push({user:currentUser.name,text:msg});
    saveAll();
    renderPrivateChat(key);
    document.getElementById("privateMsg").value="";
}
function openGroupChat(){
    document.getElementById("userMenu").classList.add("hidden");
    document.getElementById("groupChatSection").classList.remove("hidden");
    renderGroupChat();
}
function renderGroupChat(){
    let box=document.getElementById("groupChatBox");
    box.innerHTML="";
    groupChat.forEach(m=>{ box.innerHTML+=`<div class="msg"><span class="username">${m.user}:</span> ${m.text}</div>`; });
}
function sendGroupMsg(){
    let msg=document.getElementById("groupMsg").value.trim();
    if(!msg)return;
    groupChat.push({user:currentUser.name,text:msg});
    saveAll();
    renderGroupChat();
    document.getElementById("groupMsg").value="";
}
function logout(){ currentUser=null; goBack(); }
</script>

</body>
</html>
