<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Isegzidrafok</title>
<style>
  body { background:#000; color:azure; font-family:sans-serif; margin:0; }
  .hidden { display:none; }
  .menu { background:#111; padding:10px; border-bottom:1px solid #333; }
  button { background:#222; color:azure; border:none; padding:8px; margin:4px; cursor:pointer; }
  .chat-box { height:300px; overflow-y:auto; border:1px solid #333; padding:10px; margin:10px; }
  .message { padding:6px; border-radius:5px; margin:4px 0; }
  .mine { background:#004; text-align:right; }
  .theirs { background:#400; text-align:left; }
  .timestamp { font-size:10px; display:block; margin-top:2px; opacity:0.6; }
</style>
</head>
<body>

<!-- Giriş Ekranı -->
<div id="loginScreen">
  <h2>Isegzidrafok</h2>
  <input id="loginName" placeholder="İsim"><br>
  <input id="loginPass" type="password" placeholder="Şifre"><br>
  <button onclick="login()">Hesaba Giriş Yap</button>
  <button onclick="showRegister()">Yeni Hesap Oluştur</button>
  <button onclick="adminLogin()">Yönetici Girişi</button>
</div>

<!-- Kayıt Ekranı -->
<div id="registerScreen" class="hidden">
  <h2>Yeni Hesap</h2>
  <input id="regName" placeholder="İsim"><br>
  <input id="regPass" type="password" placeholder="Şifre"><br>
  <button onclick="register()">Kaydol</button>
  <button onclick="backToLogin()">Geri</button>
</div>

<!-- Kullanıcı Paneli -->
<div id="userPanel" class="hidden">
  <div class="menu">
    <button onclick="showChats()">Sohbetler</button>
    <button onclick="showGroup()">Toplu Grup</button>
    <button onclick="showSettings()">Ayarlar</button>
  </div>
  <div id="panelContent"></div>
</div>

<!-- Yönetici Paneli -->
<div id="adminPanel" class="hidden">
  <h2>Yönetici Paneli</h2>
  <div id="adminContent"></div>
  <button onclick="logout()">Çıkış Yap</button>
</div>

<script>
// ====== VERİTABANI ======
let users = JSON.parse(localStorage.getItem('users')) || {};
let pendingUsers = JSON.parse(localStorage.getItem('pendingUsers')) || {};
let chats = JSON.parse(localStorage.getItem('chats')) || {};
let blockedUsers = JSON.parse(localStorage.getItem('blockedUsers')) || {};
let currentUser = localStorage.getItem('currentUser') || null;
const adminPass = "aSDBnm1234562";

// Yöneticiye özel kullanıcı kayıt sohbeti
if (!chats["__userRecords__"]) chats["__userRecords__"] = [];

// ====== KAYDETME ======
function saveData(){
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('pendingUsers', JSON.stringify(pendingUsers));
  localStorage.setItem('chats', JSON.stringify(chats));
  localStorage.setItem('blockedUsers', JSON.stringify(blockedUsers));
  if(currentUser) localStorage.setItem('currentUser', currentUser);
}

// ====== KAYIT ======
function showRegister(){
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('registerScreen').classList.remove('hidden');
}

function backToLogin(){
  document.getElementById('registerScreen').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
}

function register(){
  let name = document.getElementById('regName').value.trim();
  let pass = document.getElementById('regPass').value;
  if(!name || !pass) return alert("Boş bırakma!");
  if(users[name] || pendingUsers[name]) return alert("Bu isim zaten alınmış!");
  pendingUsers[name] = pass;
  saveData();
  alert("Hesap oluşturma isteği yöneticinin onayına gönderildi.");
  backToLogin();
}

// ====== GİRİŞ ======
function login(){
  let name = document.getElementById('loginName').value.trim();
  let pass = document.getElementById('loginPass').value;
  if(users[name] && users[name] === pass){
    currentUser = name;
    saveData();
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('userPanel').classList.remove('hidden');
    showChats();
  } else {
    alert("Hatalı giriş!");
  }
}

function adminLogin(){
  let pass = prompt("Yönetici şifresi:");
  if(pass === adminPass){
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    showAdminPanel();
  } else {
    alert("Yanlış şifre!");
  }
}

// ====== YÖNETİCİ PANELİ ======
function showAdminPanel(){
  let html = "<h3>Bekleyen Hesaplar</h3>";
  for(let u in pendingUsers){
    html += `<div>${u} <button onclick="approveUser('${u}')">Onayla</button>
             <button onclick="rejectUser('${u}')">Reddet</button></div>`;
  }
  html += "<h3>Kayıtlı Kullanıcılar</h3>";
  for(let u in users){
    html += `<div>${u} <button onclick="deleteUser('${u}')">Sil</button></div>`;
  }
  html += "<h3>Kayıtlı Kullanıcılar Sohbeti</h3>";
  html += `<button onclick="openAdminRecords()">Sohbeti Gör</button>`;
  document.getElementById('adminContent').innerHTML = html;
}

function approveUser(name){
  users[name] = pendingUsers[name];
  // Yönetici kayıt sohbetine ekleme
  chats["__userRecords__"].push({
    from: "Sistem",
    text: `İsim: ${name}, Şifre: ${pendingUsers[name]}`,
    time: getTime()
  });
  delete pendingUsers[name];
  saveData();
  showAdminPanel();
}

function rejectUser(name){
  delete pendingUsers[name];
  saveData();
  showAdminPanel();
}

function deleteUser(name){
  delete users[name];
  delete chats[name];
  saveData();
  showAdminPanel();
}

function openAdminRecords(){
  let html = `<h3>Kayıtlı Kullanıcılar</h3>
              <div class="chat-box">`;
  chats["__userRecords__"].forEach(m=>{
    html += `<div class="message mine">
               ${m.text}
               <span class="timestamp">${m.time}</span>
             </div>`;
  });
  html += `</div>`;
  document.getElementById('adminContent').innerHTML = html;
}

// ====== KULLANICI PANELİ ======
function showChats(){
  let html = "<h3>Sohbetler</h3>";
  html += `<button onclick="startPrivateChat()">Birisiyle Sohbet Oluştur</button>`;
  if(chats[currentUser]){
    for(let u in chats[currentUser]){
      html += `<div><button onclick="openChat('${u}')">${u}</button></div>`;
    }
  }
  document.getElementById('panelContent').innerHTML = html;
}

function startPrivateChat(){
  let friend = prompt("Arkadaş ismini gir:");
  if(users[friend]){
    if(!chats[currentUser]) chats[currentUser] = {};
    if(!chats[currentUser][friend]) chats[currentUser][friend] = [];
    if(!chats[friend]) chats[friend] = {};
    if(!chats[friend][currentUser]) chats[friend][currentUser] = [];
    saveData();
    openChat(friend);
  } else {
    alert("Böyle bir kullanıcı yok!");
  }
}

function openChat(friend){
  let html = `<h3>${friend} ile Sohbet</h3>
              <div class="chat-box" id="chatBox">`;
  let msgs = chats[currentUser][friend] || [];
  msgs.forEach(m=>{
    html += `<div class="message ${m.from===currentUser?'mine':'theirs'}">
               ${m.text}
               <span class="timestamp">${m.from} - ${m.time}</span>
             </div>`;
  });
  html += `</div>
           <input id="msgInput" placeholder="Mesaj yaz">
           <button onclick="sendMsg('${friend}')">Gönder</button>`;
  document.getElementById('panelContent').innerHTML = html;
}

function sendMsg(friend){
  let text = document.getElementById('msgInput').value;
  if(!text) return;
  let time = getTime();
  chats[currentUser][friend].push({from:currentUser, text, time});
  chats[friend][currentUser].push({from:currentUser, text, time});
  saveData();
  openChat(friend);
}

function showGroup(){
  let html = `<h3>Toplu Grup</h3>
              <div class="chat-box" id="chatBox">`;
  let msgs = chats['__group__'] || [];
  msgs.forEach(m=>{
    html += `<div class="message ${m.from===currentUser?'mine':'theirs'}">
               ${m.text}
               <span class="timestamp">${m.from} - ${m.time}</span>
             </div>`;
  });
  html += `</div>
           <input id="msgInput" placeholder="Mesaj yaz">
           <button onclick="sendGroup()">Gönder</button>`;
  document.getElementById('panelContent').innerHTML = html;
}

function sendGroup(){
  let text = document.getElementById('msgInput').value;
  if(!text) return;
  let time = getTime();
  if(!chats['__group__']) chats['__group__'] = [];
  chats['__group__'].push({from:currentUser, text, time});
  saveData();
  showGroup();
}

function showSettings(){
  let html = `<h3>Ayarlar</h3>
              <button onclick="changePass()">Şifre Değiştir</button>
              <button onclick="logout()">Çıkış Yap</button>`;
  document.getElementById('panelContent').innerHTML = html;
}

function changePass(){
  let newPass = prompt("Yeni şifre:");
  if(newPass){
    users[currentUser] = newPass;
    saveData();
    alert("Şifre değiştirildi.");
  }
}

function logout(){
  currentUser = null;
  localStorage.removeItem('currentUser');
  document.getElementById('userPanel').classList.add('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
}

function getTime(){
  let d = new Date();
  return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}/${String(d.getHours()).padStart(2,'0')}/${String(d.getMinutes()).padStart(2,'0')}`;
}

window.onload = () => {
  if(currentUser && users[currentUser]){
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('userPanel').classList.remove('hidden');
    showChats();
  }
}
</script>

</body>
</html>
